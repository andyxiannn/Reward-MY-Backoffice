
<head>
    <link href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css" rel="stylesheet" />
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.18/js/jquery.dataTables.min.js" defer></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
    <link href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="text/javascript" src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <link rel="stylesheet" href="~/css/datatable/dataTables.min.css">
    <link rel="stylesheet" href="~/css/datatable/jquery.dataTables.min.css">

</head>
<div class="row pt-4">
    <div class="col-6">
        <h2 class="text-primary">Client List</h2>
    </div>
    @*<div class="col-6 text-right">
            <a asp-controller="DealersManagement" asp-action="Create" class="btn btn-primary">
                <i class="fas fa-plus"></i> &nbsp; Add New Dealer
            </a>
        </div>*@

    
</div>
<div class="well form-inline row">
    <div class="col-6">
        <input type="text" name="searchTerm" value="" class="form-control margintop10 " id="searchTerm" placeholder="Name, Client code, IC or Passport" style="min-width: 500px;">
        <button style="margin-left:10px;min-width:50px" id="searchClient" class="btn btn-info margintop10" onclick="Search()"><i class="fa fa-search"></i>&nbspSearch</button>

    </div>
</div>
    <br />
    <br />
    <div class="row">
        <div class="col-lg-12 ">
            <div class="table-responsive">
                <table id="tblClient" class="table table-striped table-bordered table-hover dataTable no-footer">
                    <thead>
                        <tr role="row">
                            <th>Client Id</th>
                            <th>Name</th>
                            <th>Code</th>
                            <th>IC</th>
                            <th>Passport</th>
                            <th>Client Tier</th>
                            <th>Status</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script type="text/javascript">
    //$(document).ready(function () {
    //    $('#tblDealers').DataTable({
    //        "ajax": {
    //            "url": '/api/Dealers/GetClients',
    //            "dataSrc": ''
    //        },
    //        bAutoWidth: false,
    //        columns: [
    //            { data: 'client_id' },
    //            { data: 'client_name', className: "text-center"},
    //            { data: 'client_code', className: "text-center"},
    //            { data: 'IC', className: "text-center"},
    //            { data: 'passport', className: "text-center"},
    //            {
    //                data: 'status',
    //                render: function (data, type, row) {
    //                    return (data === true) ? "<span class='glyphicon glyphicon-ok'></span > " : " <span class='glyphicon glyphicon-remove'></span > ";
    //                },
    //                className: "text-center"
    //            },
    //            {
    //                data: "id",
    //                render: function (data, type, row, meta) {
    //                    return  "<button class='btn btn-success' style='margin-right:5px;' onclick=View(" + JSON.stringify(row) + ")>View</button>" +
    //                            "<button class='btn btn-primary' style='margin-right:5px;' onclick=Edit(" + JSON.stringify(row) + ")>Edit</button>" +
    //                            "<button class='btn btn-danger' style='margin-right:5px;' onclick= Delete(" + JSON.stringify(row) + ")>Delete</button>";
    //                },
    //                className: "text-center"
    //            },

    //        ]
    //    });


    //});

    function Search() {           
           
            //alert(searchTerm.value);
            if (document.getElementById("searchTerm").value.length == 0) {
                alert("Please enter some value before searching. ")
            }
            else
            {
                $('#tblClient').DataTable().destroy();
                searchTerm = document.getElementById('searchTerm');
                $(document).ready(function () {
             
                $('#tblClient').DataTable({
                    "ajax": {
                        type: "POST",
                        url: '/api/Dealers/SearchClient/' + searchTerm.value,
                        //data: {
                        //    id: searchTerm.value,
                        //},
                        contentType: 'application/json',
                        dataType: 'json',
                        dataSrc: '',
                        //destroy: true,
                    },
                    autoWidth: true,
                    columns: [
                        { data: 'client_id', "sWidth": "50px" },
                        { data: 'client_name', className: "text-center" },
                        { data: 'client_code', className: "text-center", "sWidth": "50px" },
                        { data: 'IC', className: "text-center", "sWidth": "150px" },
                        { data: 'passport', className: "text-center", "sWidth": "100px" },
                        { data: 'client_tier_id', className: "text-center", "sWidth": "100px" },
                        {
                            data: 'status',
                            render: function (data, type, row) {
                                return (data === true) ? "<span class='glyphicon glyphicon-ok'></span > " : " <span class='glyphicon glyphicon-remove'></span > ";
                            },
                            className: "text-center", "sWidth": "50px"
                        },
                        {
                            data: "id",
                            render: function (data, type, row, meta) {
                                return "<button class='btn btn-success' style='margin-right:5px;' onclick=View(" + JSON.stringify(row.client_id) + ")>View</button>";
                                //"<button class='btn btn-primary' style='margin-right:5px;' onclick=Edit(" + JSON.stringify(row) + ")>Edit</button>";
                                // "<button class='btn btn-danger' style='margin-right:5px;' onclick= Delete(" + JSON.stringify(row) + ")>Delete</button>";
                            },
                            className: "text-center"
                        },

                    ]
                });

            });
        }
           
    }

    function Edit(oDealer) {
       var url = '@Url.Action("Edit", "DealersManagement", new { id = "__id__" })';
        window.location.href = url.replace('__id__', oDealer.DealerId);
    }

    function Delete(oDealer) {
      /* $.delete("api/Dealer?id=" + oDealer.DealerId, function () {
            alert("Deleted");
            ReloadGrid();
        });*/
        //if (confirm("Are you sure?"))
        //{
            //var url = '@Url.Action("Delete", "DealersManagement", new { id = "__id__" })';
            //window.location.href = url.replace('__id__', oDealer.DealerId);
        //}
        //return false;

        swal({
            title: "Are you sure?",
            text: "Once deleted, you will not be able to recover",
            icon: "warning",
            dangerMode: true,
            buttons: [
            'No, cancel it!',
            'Yes, I am sure!'
          ],

        }).then((willDelete) => {

            if (willDelete) {
                var url = '@Url.Action("Delete", "Client", new { id = "__id__" })';
                window.location.href = url.replace('__id__', oDealer.DealerId);
                $.ajax({
                    type: "POST",
                    url: url,
                    success: function (data) {

                        alert("Successfully Deleted ! ");

                        window.location.href = '@Url.Action("Index", "Client")';
                        ReloadGrid();

                       //swal("Deleted", "Your Dealer is deleted :)", "success");
                    }
                })

            }
            else
            {
                swal("Cancelled", "Your Dealer is safe :)", "error");
            }

        }

        )

    }
    function View(client_id) {
        var url = '@Url.Action("Views", "Client", new { id = "__id__" })';
        window.location.href = url.replace('__id__', client_id);
    }

    function ReloadGrid() {
        $('#tblClient').DataTable().clear();
        $('#tblClient').DataTable().ajax.reload();
    }

    </script>
